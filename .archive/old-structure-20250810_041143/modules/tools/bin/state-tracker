#!/bin/bash
# State Tracker Tool - Module Interface

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
MODULE_DIR="$(dirname "$SCRIPT_DIR")"

# Load the tool
source "$MODULE_DIR/src/state-tracker/core.sh"

# Main command handler (from original script)
case "$1" in
    "show"|"status")
        show_state
        ;;
    "update")
        update_stage "$2" "$3"
        ;;
    "complete")
        add_completed "$2"
        ;;
    "error")
        record_error "$2" "$3"
        ;;
    "log")
        show_log "$2"
        ;;
    "metrics")
        show_metrics
        ;;
    "checkpoint")
        create_checkpoint "$2"
        ;;
    "archives")
        list_archives
        ;;
    *)
        echo "State Tracker - Workflow State Management"
        echo ""
        echo "Usage: $0 <command> [options]"
        echo ""
        echo "Commands:"
        echo "  show/status         - Show current state"
        echo "  update <s> <sub>    - Update stage and substage"
        echo "  complete <step>     - Mark step as completed"
        echo "  error <e> [sol]     - Record error with optional solution"
        echo "  log [n|--all]       - Show last n lines of log (default 20)"
        echo "  metrics             - Show workflow metrics"
        echo "  checkpoint [name]   - Create named checkpoint"
        echo "  archives            - List archived sessions"
        ;;
esac