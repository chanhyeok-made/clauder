---
doc_id: 203
---

# 중앙 버전 트리 시스템 설계

## 개요

기존의 각 문서마다 전체 참조 정보를 중복 저장하는 방식에서 벗어나, 중앙 집중식 버전 트리를 통해 토큰을 대폭 절약하는 새로운 시스템입니다.

## 문제점

### 기존 방식의 한계
1. **토큰 낭비**: 각 문서마다 10-20줄의 메타데이터
2. **업데이트 복잡성**: 하나 수정 시 여러 파일 업데이트
3. **일관성 문제**: 수동 업데이트로 인한 불일치
4. **확장성 한계**: 문서가 많아질수록 관리 어려움

## 해결책: 중앙 버전 트리

### 핵심 아이디어
```yaml
# 기존: 각 문서에 전체 정보
---
version:
  created: "2025-08-02"
  updated: "2025-08-02"
  commit: "abc123"
dependencies:
  - file: "path/to/file1.md"
    commit: "def456"
  - file: "path/to/file2.md"
    commit: "ghi789"
references:
  - file: "path/to/ref1.md"
    commit: "jkl012"
---

# 새로운 방식: ID만 참조
---
doc_id: 1
---
```

### 중앙 트리 구조
```yaml
# .claude/version-tree.yaml
documents:
  1:
    path: "/path/to/document.md"
    created: "2025-08-02"
    updated: "2025-08-02"
    commit: "abc123"
    depends_on: [2, 3]      # ID만 저장
    referenced_by: [4, 5]   # ID만 저장
```

## 장점

### 1. 토큰 절약
- 문서당 20줄 → 2줄로 감소 (90% 절약)
- 100개 문서 기준: 2000토큰 → 200토큰

### 2. 업데이트 효율성
- 트리 파일 하나만 수정
- 자동화 가능
- 일괄 업데이트 지원

### 3. 순환 참조 방지
- 트리에서 그래프 알고리즘으로 쉽게 탐지
- 실시간 검증 가능

### 4. 확장성
- 문서 수에 관계없이 일정한 성능
- 대규모 프로젝트에 적합

## 구현

### ID 할당 규칙
```
1-99: 핵심 원칙 문서
100-199: 명령어 문서
200-299: 설계 문서
300-399: 가이드 문서
400-499: 템플릿 문서
500-599: 기타 문서
1000+: 프로젝트 루트 문서
```

### 관리 스크립트
`version-tree-manager.py` 제공:
- `update`: 문서 업데이트
- `depend`: 의존성 추가
- `affected`: 영향받는 문서 확인
- `status`: 전체 상태 확인

### 사용 예시
```bash
# 문서 업데이트
python version-tree-manager.py update /path/to/doc.md

# 의존성 추가
python version-tree-manager.py depend /from.md /to.md

# 영향 확인
python version-tree-manager.py affected /doc.md
```

## 마이그레이션 전략

### Phase 1: 공존
- 기존 방식과 새 방식 동시 지원
- 점진적 전환

### Phase 2: 자동 변환
- 스크립트로 기존 메타데이터 추출
- 중앙 트리로 자동 이전

### Phase 3: 완전 전환
- 문서에는 doc_id만 유지
- 모든 버전 관리는 트리에서

## 미래 개선사항

### 1. 캐싱
- 자주 접근하는 참조 관계 캐싱
- 메모리 내 트리 유지

### 2. 실시간 동기화
- 파일 변경 감지 시 자동 업데이트
- Git hooks와 통합

### 3. 시각화
- 문서 의존성 그래프 생성
- 웹 기반 대시보드

## 결론

중앙 버전 트리 시스템은 토큰을 90% 절약하면서도 더 효율적인 문서 관리를 가능하게 합니다. 특히 대규모 프로젝트에서 그 효과가 극대화됩니다.